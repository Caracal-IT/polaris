<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Polaris Workflow</title>

    <link rel="icon" type="image/png" href="./img/icons/favicon.png" />

    <meta name="theme-color" content="#2A3443" />
    <meta name="description" content="Polaris WF App." />

    <!-- iOS -->
    <link rel="apple-touch-icon" href="./img/icons/icon-144x144.png" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-title" content="TutorialApp" />

    <script>
      if (!window.customElements) {
        document.write('<!--');
      }
    </script>
    <script nomodule src="./vendor/custom-elements-es5-adapter.js"></script>
    <!-- ! DO NOT REMOVE THIS COMMENT, WE NEED ITS CLOSING MARKER -->
  </head>

  <body>
    <header><h1>Polaris Workflow</h1></header>

    <main>
      <polaris-workflow id="wf" process="process1"></polaris-workflow>
      <hr/>
      <button id="loadButton">Load Workflow</button>
      <button id="loadButton2">Load Workflow 2</button>
      <button id="clearButton">Clear</button>
      <button id="processButton">Process</button>
    </main>

    <script nomodule src="./vendor/webcomponents-loader.js"></script>

    <script type="module">
      export class MoonButton extends HTMLElement {
          static get observedAttributes() { return ['caption', 'next']; }

          get next() { return this.getAttribute("next"); }
          set next(val) { this.setAttribute("next", val); }

          get caption() { return this.getAttribute("caption"); }
          set caption(val) { this.setAttribute("caption", val); }

          connectedCallback() {             
              this.button = document.createElement("button");
              this.button.innerText = this.caption;
              this.appendChild(this.button);
              this.handler = this.clickHandler.bind(this);          
              this.button.addEventListener('click', this.handler);
            }

            disconnectedCallback() {         
              this.button.removeEventListener('click', this.handler);
            }

            clickHandler() {
              const next = this.next;  
              this.ctx.wf.goto(next);         
            }
        }

        customElements.define('moon-button', MoonButton);
    </script>

    <script>
      var loadButton = document.getElementById("loadButton");
      var loadButton2 = document.getElementById("loadButton2");
      var clearButton = document.getElementById("clearButton");
      var processButton = document.getElementById("processButton");

      var wf = document.getElementById("wf");

      loadButton.addEventListener('click', function() {
        wf.controls = [
          {"tag": "input", "value": "Input 1"},
          {"tag": "input", "value": "Input 2"}
        ];
      });

      loadButton2.addEventListener('click', function() {
        wf.controls = [
          {"tag": "input"},
          {"tag": "input", "value": "Input 4"},
          {"tag": "input", "value": "Input 5"}
        ];
      });

      clearButton.addEventListener('click', function() {
        wf.controls = null;
      });

      var process = {
        "name" : "Process 1",
        "activities": [
          {
            "name": "start",
            "type": "page-activity",
            "controls": [
              {"tag": "input", "value": "Input 10"},
              {"tag": "input", "value": "Input 11"},
              {"tag": "moon-button", "caption": "Next", "next": "details"}
            ]
          },
          {
            "name": "details",
            "type": "page-activity",
            "controls": [
              {"tag": "input", "value": "Input 110"},
              {"tag": "input", "value": "Input 111"},
              {"tag": "moon-button", "caption": "Start", "next": "start"}
            ]
          }
        ]
      };

      processButton.addEventListener('click', function() {
        wf.load(process);
      });
    </script>
  </body>
</html>