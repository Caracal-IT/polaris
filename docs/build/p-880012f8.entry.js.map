{"version":3,"names":["AnalyticsService","sendMessage","event","this","sendPostMessage","send","actType","path","wfElement","find","i","undefined","payload","createPayload","type","process","activity","control","valueHash","wfPath","map","getName","getPath","composedPath","message","msg","timestamp","Date","now","console","log","window","postMessage","item","id","page","name","notFound","p","filter","nodeName","indexOf","wfPage","localName","wfPageElement","ctx","wf","slice","act","getHashCode","str","startIndex","hashLength","hash","length","Math","imul","charCodeAt","PolarisAnalytics","async","analyticsService","lastPath","addEventListener","onBlur","wfMessage","target","removeEventListener","HttpService","constructor","settingOffset","clientError","unAuthorizedError","endpoint","response","fetch","resolveSetting","url","getConfig","status","error","json","metadata","code","statusText","setTimeout","config","method","mode","headers","Object","apply","redirect","referrer","body","JSON","stringify","val","counter","matches","match","result","reduce","replace","bind","prev","next","replacement","getSetting","currencyFormat","value","locale","currency","formatter","Intl","NumberFormat","style","format","PipeFactory","getRandomValues","rnds8","Uint8Array","rng","crypto","Error","byteToHex","push","toString","unsafeStringify","arr","offset","toLowerCase","randomUUID","native","v4","options","buf","rnds","random","ModelService","model","sessionId","uuidv4","replaceAll","pipes","getValue","key","split","total","currentElement","getInterpolatedValue","myRegexp","curr","setValue","addSetting","merge","save","sessionStorage","setItem","load","getItem","clearCache","parse","clear","newModel","current","index","padding","firstIndex","secondIndex","expr","substring","values","params","newValue","ConfigService","settings","setting","BaseActivity","gotoNext","goto","RedirectActivity","_a","location","href","FinishActivity","stack","ipc","pop","setProcess","IPCActivity","CodeActivity","evaluate","expression","f","Function","PageActivity","controls","NullActivity","Promise","_resolve","reject","ApiActivity","callEndpoints","endpoints","getBody","callEndpoint","http","then","data","setModel","hasModel","toUpperCase","mappings","m","direction","forEach","assign","remote","client","keys","k","AssignActivity","DecisionActivity","exp","trueAction","falseAction","SwitchActivity","rules","rule","ActivityFactory","static","activities","a","deleteCount","findIndex","splice","WorkflowService","clearStack","loader","err","description","tryNext","isValidProcess","validator","validate","newActivity","create","execute","Validator","setError","errorMessage","el","setAttribute","nextSibling","textContent","RequiredValidator","context","isEmpty","super","RegexValidator","regex","RegExp","exec","isValid","RangeValidator","min","max","ValidatorService","validators","ctrl","validateControl","addValidator","v","sendErrorMsg","PageBuilder","build","parent","onInput","clearPage","addComponent","childNodes","removeChild","newEl","tag","createWorkflowElement","createElement","appendChild","addErrorLabel","document","setServices","bindCaption","oninput","interpolate","prop","errLabel","parentNode","HttpWorkflowLoader","processName","PolarisWorkflow","hostRef","_components","dir","_render","add","resolve","metaData","_b","activityType","_c","_isConnected","emit","disconnectedCallback","connectedCallback","_loader","hasAttribute","builder"],"sources":["./src/services/analytics.service.ts","./src/components/polaris-analytics/polaris-analytics.tsx","./src/services/http.service.ts","./src/pipes/currency-format.pipe.ts","./src/pipes/factory.pipe.ts","./node_modules/uuid/dist/esm-browser/rng.js","./node_modules/uuid/dist/esm-browser/stringify.js","./node_modules/uuid/dist/esm-browser/native.js","./node_modules/uuid/dist/esm-browser/v4.js","./src/services/model.service.ts","./src/services/config.service.ts","./src/activities/base.activity.ts","./src/activities/redirect.activity.ts","./src/activities/finish.activity.ts","./src/activities/ipc.activity.ts","./src/activities/code.activity.ts","./src/activities/page.activity.ts","./src/activities/null.activity.ts","./src/activities/api.activity.ts","./src/activities/assign.activity.ts","./src/activities/decision.activity.ts","./src/activities/switch.activity.ts","./src/activities/activity-factory.ts","./src/services/workflow.service.ts","./src/validators/validator.ts","./src/validators/required.validator.ts","./src/validators/regex.validator.ts","./src/validators/range.validator.ts","./src/services/validator.service.ts","./src/utilities/page-builder.utility.ts","./src/utilities/workflow-loader.utility.ts","./src/components/polaris-workflow/polaris-workflow.tsx"],"sourcesContent":["export class AnalyticsService {\n    sendMessage(event: object) {\n        this.sendPostMessage(event[\"detail\"]);\n    }\n\n    send(actType: string, path: HTMLElement[]) {\n        const wfElement = path.find(i => i[\"wf-Workflow\"] !== undefined);\n        \n        if(!wfElement)\n            return;\n\n        const payload = this.createPayload(actType, wfElement, path);\n\n        if(payload !== undefined && payload !== null) {\n            this.sendPostMessage({\n                type: payload.type, \n                process: payload.process,\n                activity: payload.activity, \n                control: payload.control, \n                valueHash: payload.valueHash,\n                path: payload.wfPath.map(this.getName)\n            });\n        }\n    }\n\n    getPath(event: {composedPath(event: object)}) {\n        return event.composedPath(event);\n    }\n\n    private sendPostMessage(message: object) {\n        const msg: object = {...message, timestamp:Date.now()};\n\n        console.log(\"ANALYTICS\", msg);\n        window.postMessage(msg, \"*\");\n    }\n\n    private getName(item: HTMLElement & {id: string, page: {name: string}}): string {\n        if(item.id != null)\n            return item.id;\n\n        if(item.page !== null && item.page.name !== null)\n            return item.page.name;\n\n        return \"\";\n    }\n\n    private createPayload(actType: string, wfElement: HTMLElement, path: HTMLElement[]){\n        const notFound = -1;\n\n        if(path == null || path == undefined)\n            return null;\n\n        const p = path.filter(i => i.nodeName !== undefined && i.nodeName !== null && i.nodeName.indexOf(\"document-fragment\") === notFound);\n        const wfPage = p.find(i => i.localName === \"polaris-workflow\");\n\n        if(wfPage === null)\n            return null;\n\n        const wfPageElement = <HTMLPolarisWorkflowElement> wfPage;\n\n        const activity = wfPageElement.ctx.wf.activity; \n        const wfPath = p.slice(0, p.indexOf(wfPage) + 1);\n\n        if(activity.name === undefined || activity.name === null)\n            return null;\n\n        const process = wfPageElement.ctx.wf.process.name;\n    \n        const act = activity.name;\n        const control = wfElement.id;\n        const valueHash = this.getHashCode(wfElement[\"value\"]);\n\n        return { \"type\": actType, process, activity: act, control, valueHash, wfPath};        \n    }\n\n    private getHashCode(str: string): number {\n        if(str === undefined || str === null)\n            return 0;\n            \n        const startIndex = 0;\n        const hashLength = 31;\n\n        let hash = startIndex\n        for (let i = startIndex; i < str.length; i = i + 1)\n            hash = Math.imul(hashLength, hash) + str.charCodeAt(i)\n\n        return hash;\n    }\n}","import { Component, Listen } from \"@stencil/core\";\nimport { AnalyticsService } from \"../../services/analytics.service\";\n\n@Component({\n    tag: \"polaris-analytics\"\n  })\n  export class PolarisAnalytics {   \n    static lastPath: HTMLElement[] = [null];\n    static analyticsService: AnalyticsService = new AnalyticsService();\n\n    @Listen('click', { target: 'document' })\n    async analyticsHandler(event: Event) {\n        const path = PolarisAnalytics.analyticsService.getPath(event);\n\n        if(PolarisAnalytics.lastPath[0] === path[0])\n          return;\n \n        PolarisAnalytics.lastPath = path;\n\n        const wfElement =  path.find((i: HTMLElement) => i[\"wf-Workflow\"] !== undefined);\n\n        if(!wfElement) \n          return;\n          \n        path[0].addEventListener(\"blur\", this.onBlur);        \n        PolarisAnalytics.analyticsService.send(\"click\", path);\n    }    \n\n    @Listen('wfMessage', { target: 'document' })\n    wfMessage(event: Event){\n      PolarisAnalytics.analyticsService.sendMessage(event);\n    }\n\n    onBlur(event: Event) {\n        PolarisAnalytics.analyticsService.send(\"blur\", PolarisAnalytics.lastPath);\n        event.target.removeEventListener(\"blur\", this.onBlur);\n    }\n  }","import { Endpoint } from \"../model/endpoint.model\";\nimport { Context } from \"../model/context.model\";\n\nexport class HttpService {\n    private notFound: number = -1;\n    private startIndex: number = 0;\n    private settingOffset: number = 2;\n    private clientError: number = 400;\n    private unAuthorizedError: number = 401;\n\n    constructor(private ctx: Context) { }\n\n    async fetch(endpoint: Endpoint) {\n        try {\n            this.ctx.page.sendMessage({type: \"START_LOADING\"});\n            const response = await fetch(this.resolveSetting(endpoint.url), this.getConfig(endpoint));\n            \n            if(response.status >= this.clientError) {\n                const error = await response.json();\n\n                if(response.status >= this.unAuthorizedError)\n                    this.ctx.page.sendMessage({type: \"UN_AUTHORIZED\", metadata: { endpoint, error}});  \n\n                throw {\n                    code: response.status,\n                    message: response.statusText,\n                    error: error\n                };\n            }\n\n            return await response.json();\n        }\n        finally {\n            setTimeout(() => this.ctx.page.sendMessage({type: \"END_LOADING\"}));\n        }\n    }\n\n    private getConfig(endpoint: Endpoint): object{\n        const config =  {\n            method: endpoint.method,\n            mode: 'cors',\n            headers: Object.apply({\"Content-Type\": \"application/json\"}, endpoint.headers),\n            redirect: 'follow',\n            referrer: 'no-referrer',\n            body: endpoint.body !== null ? JSON.stringify(endpoint.body) : null\n        };\n        \n        return config;\n    }\n\n    private resolveSetting(val: string, counter: number = this.startIndex) {\n        if(counter > this.settingOffset)\n            return val;\n            \n        const matches = val.match(/\\[[\\w|_]+\\]/g);\n\n        if(matches === null)\n            return val;\n\n        let result = matches.reduce(this.replace.bind(this) , val);\n\n        if(result.indexOf('[') > this.notFound) \n            result = this.resolveSetting(result, counter + 1);\n\n        return result;\n    }\n\n    private replace(prev: string, next: string): string {\n        let replacement:string = this.ctx.config.getSetting(next);\n        \n        if(replacement !== null && replacement.indexOf('[SELF]') > this.notFound) \n           return replacement.replace('[SELF]', prev.replace(next, ''));\n\n        return prev.replace(next, replacement);\n    }\n}","export function currencyFormat(value: number, [locale, currency]: [string, string]) {\n    const formatter = new Intl.NumberFormat(locale, {\n        style: 'currency',\n        currency: currency,\n    });\n      \n    return formatter.format(+value);\n}","import { currencyFormat } from \"./currency-format.pipe\";\n\nexport class PipeFactory {\n    currencyFormat: object = currencyFormat;\n}","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase();\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","import { PipeFactory } from \"../pipes/factory.pipe\";\nimport { ConfigService } from \"./config.service\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nexport class ModelService {\n    model: object = {};\n    sessionId: string = uuidv4().replaceAll('-', 'R');\n    pipes: PipeFactory = new PipeFactory();\n\n    constructor(private config: ConfigService) {}\n\n    getValue(key: string, model: object = this.model) {       \n        if(key.indexOf('[') === 0 || key.indexOf(']') === key.length - 1) \n          return this.config.getSetting(key);\n\n        const val = key.split(\".\").reduce((total, currentElement) => total != null ? total[currentElement]: undefined, {...model});\n        \n       if(key.match(/([a-z|A-Z]+\\.[a-z|A-Z]+)+/g) === null && val === undefined) \n          return key;\n\n        return val;\n    }\n\n    getInterpolatedValue(value: string) {   \n      if(value === undefined || value === null)\n        return value;\n  \n      const myRegexp = /\\{\\{\\[*(?:(\\w|\\.|\\||-)+)\\]*\\}\\}/g;\n      const match = value.match(myRegexp);\n      \n      if(match === null || match.length === 0)\n        return value;\n  \n      return match.reduce((prev, curr) => this.replaceAll(prev, curr), value);\n    }\n  \n\n    setValue(key: string, val: string | number | object) {   \n        if(key.indexOf('[') === 0 || key.indexOf(']') === key.length - 1) \n          this.config.addSetting(key, val);\n        else\n          this.model = this.merge(this.model, key, val);\n    }\n\n    save() {        \n      sessionStorage.setItem(this.sessionId, JSON.stringify(this.model));        \n    }\n\n    load() {        \n      const value = sessionStorage.getItem(this.sessionId);  \n      this.clearCache();\n      \n      if(value === null)\n          return;\n      \n      this.model =  JSON.parse(value);\n    }\n\n    clearCache() {\n      sessionStorage.clear();\n    }\n\n    private merge(model: object, name: string, value: string | number | object) {\n        if(name === null)\n          return;\n          \n        let newModel = {...model};\n      \n        name\n          .split(\".\")  \n          .reduce((total, current, index, arr) =>{\n            total[current] = index === arr.length - 1 ? value : {...total[current]};\n            return total[current];\n          }, newModel);\n      \n        return newModel;\n    }\n\n    private replaceAll(value: string, key: string) {\n      const padding = 2;\n      const startIndex = 2;\n      const firstIndex = 0;\n      const secondIndex = 1;\n\n      const expr = key.substring(padding, key.length - padding);\n      const values = expr.split('|');\n      const params = values.slice(startIndex);\n      let newValue = this.getValue(values[firstIndex]);\n\n      if(values != null && values.length > 1 && this.pipes[values[secondIndex]] != null)\n        newValue = this.pipes[values[secondIndex]](newValue, params);\n      \n      return value.replace(key, newValue);\n    }\n  \n}","export class ConfigService {\n    private settings: object = {};\n\n    getSetting(key: string) {\n        return this.settings[key];\n    }\n\n    addSetting(key: string, setting: object | string | number) {\n        if(key.indexOf('[') === -1)\n            key = `[${key}]`;\n\n        this.settings[key] = setting;\n    }\n}","import { Context } from \"../model/context.model\";\nimport { Activity } from \"./activity\";\n\nexport abstract class BaseActivity implements Activity {\n    name: string;\n    \"type\": string;\n    next:string;\n    ctx: Context;\n\n    abstract execute(): Promise<boolean>;\n\n    gotoNext() {\n        if(this.next !== undefined && this.ctx !== undefined)\n            this.ctx.wf.goto(this.next);\n    }\n}","import { BaseActivity } from \"./base.activity\";\n\nexport class RedirectActivity extends BaseActivity {\n    name: string = \"redirect\";\n    \"type\": string = \"redirect-activity\";\n    location?: string;\n       \n    async execute(): Promise<boolean> {\n        this.ctx.model.save();\n        \n        const params = `${this.ctx.wf.process?.name}-${this.next}-${this.ctx.model.sessionId}`;\n        window.location.href = `${this.location}?returnUrl=${params}`;    \n        return true;\n    }\n}","import { BaseActivity } from \"./base.activity\";\n\nexport class FinishActivity extends BaseActivity {\n    name: string = \"finish\";\n    \"type\": string = \"finish-activity\";\n       \n    async execute(): Promise<boolean> {\n        if(this.ctx.wf.stack.length === 0) {\n            this.gotoNext();\n\n            return true;\n        }\n\n        const ipc = this.ctx.wf.stack.pop();\n        await this.ctx.wf.setProcess(ipc.process, ipc.activity);\n            \n        return true;\n    }\n}","import { BaseActivity } from \"./base.activity\";\n\nexport class IPCActivity extends BaseActivity {\n    name: string = \"ipc\";\n    \"type\": string = \"ipc-activity\";\n    process: string; \n       \n    async execute(): Promise<boolean> {\n        if(this.process !== null && this.process.length > 0) {\n            this.ctx.wf.stack.push({\n                process: this.ctx.wf.process.name,\n                activity: this.next\n            });\n          \n            await this.ctx.wf.setProcess(this.ctx.model.getInterpolatedValue(this.process), 'start', this.next !== undefined ? false : true);\n        }\n            \n        return true;\n    }\n}","import { Context } from \"../model/context.model\";\nimport { BaseActivity } from \"./base.activity\";\n\nexport class CodeActivity extends BaseActivity {\n    name: string = \"code\";\n    \"type\": string = \"code-activity\";\n    expression: string;\n       \n    async execute(): Promise<boolean> {\n        this.evaluate(this.expression, this.ctx); \n        this.gotoNext();\n            \n        return true;\n    }\n\n    evaluate(expression: string, ctx: Context) {\n        const f =  new Function('ctx', expression);        \n        return f(ctx);                \n    }\n}","import { Activity } from \"./activity\";\nimport { Context } from \"../model/context.model\";\nimport { Control } from \"../model/control.model\";\n\nexport class PageActivity implements Activity {\n    name: string = \"start\";\n    \"type\": string = \"page-activity\";\n    \n    ctx: Context;\n    controls: Control[];\n\n    async execute(): Promise<boolean> {\n        this.ctx.page.controls = this.controls;    \n        return true;\n    }\n}\n","import { Activity } from \"./activity\";\n\nexport class NullActivity implements Activity {\n    name: string = \"undefined\";\n    \"type\": string = \"null-activity\";\n\n    async execute(): Promise<boolean> {\n        return new Promise((_resolve, reject) => reject(\"NULL Activity\"));\n    }\n}\n","import { HttpService } from \"../services/http.service\";\nimport { ApiEndpoint } from \"../model/api-endpoint.model\";\nimport { BaseActivity } from \"./base.activity\";\n\nexport class ApiActivity extends BaseActivity {\n    name: string = \"start\";\n    \"type\": string = \"api-activity\";\n    endpoints: ApiEndpoint[];\n\n     async execute(): Promise<boolean> {  \n        await this.callEndpoints();\n        this.gotoNext();\n        return true;\n    }\n\n    private async callEndpoints(): Promise<boolean> {\n        for(const endpoint of this.endpoints) {\n            endpoint.body = this.getBody(endpoint);\n            \n            await this.callEndpoint(this.ctx.http, endpoint);\n        }\n\n        return true;\n    }\n\n    private async callEndpoint(http: HttpService, endpoint: ApiEndpoint) {\n        return http.fetch(endpoint)\n                   .then(data => this.setModel(endpoint, data));\n    }\n\n    private getBody(endpoint: ApiEndpoint) {\n        if(!this.hasModel() || endpoint.method.toUpperCase() === \"GET\" || endpoint.method.toUpperCase() === \"DELETE\")\n            return null;\n\n        const model = this.ctx.model;\n        const mappings = endpoint.mappings;\n\n        let body = {};\n        mappings\n            .filter(m => m.direction === 'out' || m.direction === 'inout')\n            .forEach(m => Object.assign(body, {[m.remote]: model.getValue(m.client)}));\n        \n        return body;\n    }\n\n    private setModel(endpoint: ApiEndpoint, data: object) {\n        if(!this.hasModel())\n            return;\n\n        const model = this.ctx.model;\n        const mappings = endpoint.mappings;\n\n        if(mappings === null || mappings.length === 0)             \n            return Object.keys(data).forEach(k => model.setValue(k, data[k]));  \n        \n        mappings\n            .filter(m => m.direction === 'in' || m.direction === 'inout')\n            .forEach(m => model.setValue(m.client, model.getValue(m.remote, data)));\n    }\n\n    private hasModel(): boolean {\n        return this.ctx !== undefined \n            && this.ctx !== null \n            && this.ctx.model !== undefined\n            && this.ctx.model !== null;\n    }\n}\n\n\n","import { BaseActivity } from \"./base.activity\";\n\nexport class AssignActivity extends BaseActivity {\n    name: string = \"assign\";\n    \"type\": string = \"assign-activity\";\n    key: string;\n    value: string | null | undefined;\n    \n    async execute(): Promise<boolean> {\n        const value = this.ctx.model.getInterpolatedValue(this.value);            \n                \n        this.ctx.model.setValue(this.key, value);         \n        this.gotoNext();\n            \n        return true;\n    }\n}","import { CodeActivity } from './code.activity';\nimport { Context } from \"../model/context.model\";\n\nexport class DecisionActivity extends CodeActivity {\n    name: string = \"decision\";\n    \"type\": string = \"decision-activity\";\n\n    ctx: Context;\n    expression: string;\n    trueAction: string;\n    falseAction: string;    \n    \n    async execute(): Promise<boolean> {\n        const exp  = `return ${this.ctx.model.getInterpolatedValue(this.expression)};`;\n           \n        if(this.evaluate(exp, this.ctx)) \n            this.ctx.wf.goto(this.trueAction);\n        else\n            this.ctx.wf.goto(this.falseAction);\n\n        return true;\n    }\n}","import { CodeActivity } from \"./code.activity\";\nimport { Context } from \"../model/context.model\";\nimport { Rule } from \"../model/rule.model\";\n\nexport class SwitchActivity extends CodeActivity {\n    name: string = \"switch\";\n    \"type\": string = \"switch-activity\";\n\n    ctx: Context;\n    rules: Rule[];\n    \n    async execute(): Promise<boolean> {\n       if(this.rules === null || this.rules === undefined)\n            throw new Error(`No valid rule in ${this.name} found !!`);\n\n       for(let rule of this.rules) {\n           const expression  = `return ${this.ctx.model.getInterpolatedValue(rule.expression)};`;\n           \n           if(this.evaluate(expression, this.ctx)) {\n              this.gotoNext();\n              return true;\n           }\n       }\n\n       throw new Error(`No valid rule in ${this.name} found !!`);\n    }\n}","import { RedirectActivity } from './redirect.activity';\nimport { FinishActivity } from './finish.activity';\nimport { IPCActivity } from './ipc.activity';\nimport { CodeActivity } from './code.activity';\nimport { Activity } from \"./activity\";\nimport { PageActivity } from \"./page.activity\";\nimport { NullActivity } from \"./null.activity\";\nimport { Context } from \"../model/context.model\";\nimport { ApiActivity } from \"./api.activity\";\nimport { AssignActivity } from \"./assign.activity\";\nimport { DecisionActivity } from \"./decision.activity\";\nimport { SwitchActivity } from './switch.activity';\n\nexport class ActivityFactory {\n    static activities: Activity[] = [\n        new NullActivity(),\n        new PageActivity(),\n        new ApiActivity(),\n        new AssignActivity(),\n        new CodeActivity(),\n        new DecisionActivity(),\n        new IPCActivity(),\n        new FinishActivity(),\n        new RedirectActivity(),\n        new SwitchActivity()\n    ];\n\n    static create(config: object, ctx: Context): Activity {\n        if (config === null || config === undefined || config[\"type\"] === undefined || config[\"type\"] === null)\n            return new NullActivity();\n\n        let act = ActivityFactory.activities.find(a => a[\"type\"] === config[\"type\"]);\n\n        if (act == null)\n            return new NullActivity();\n\n        return Object.assign(act, config, { ctx });\n    }\n\n    static add(activity: Activity, replace: boolean = false) {\n        const notFound = -1;\n        const deleteCount = 1;\n\n        let index = ActivityFactory.activities.findIndex(a => a.type === activity.type);\n\n        if (index > notFound && !replace)\n            return;\n\n        if (index > notFound)\n            ActivityFactory.activities.splice(index, deleteCount);\n        \n        ActivityFactory.activities.push(activity); \n    }\n}\n","import { ActivityFactory } from \"../activities/activity-factory\";\n\nimport { Context } from \"../model/context.model\";\nimport { Process } from \"../model/process.model\";\nimport { Activity } from \"../activities/activity\";\nimport { WorkflowLoader } from \"../utilities/workflow-loader.utility\";\n\nexport interface WFStack {\n    process: string;\n    activity: string;\n}\n\nexport class WorkflowService {\n    loader: WorkflowLoader;\n\n    process: Process | null;\n    activity: Activity;\n    \n    stack: WFStack[] = [];\n\n    constructor(private ctx: Context){}\n    \n    async setProcess(process: string | Process, next: string = \"start\", clearStack: boolean = true): Promise<void> {\n        try {\n            if(clearStack)\n                this.stack = [];\n                \n            if(typeof process === \"string\" && this.loader != null)              \n                process = await this.loader.load(process);\n            \n            if(typeof process === \"string\")\n                return Promise.reject(\"Workflow not found\");\n\n            this.process = process; \n            this.activity = null;\n\n            this.goto(next);\n\n            this.ctx.page.sendMessage({type: \"PROCESS_CHANGED\", metadata: {stack: this.stack}});\n        }\n        catch(err) {\n            if(err) {\n                console.error(err);\n                this.ctx.page.sendMessage({type: \"ERROR\", description: err.message, metadata: err});\n            }\n        }\n    }\n\n    goto(name: string) {\n        setTimeout(this.tryNext.bind(this, name));    \n    }\n\n    private async tryNext(name: string) {       \n        try {        \n            this.ctx.page.sendMessage({type: \"WORKFLOW_CHANGING\"});\n            await this.next(name);\n            this.ctx.page.sendMessage({type: \"WORKFLOW_CHANGED\"});\n        }\n        catch(err) {\n            this.ctx.page.sendMessage({type: \"ERROR\", description: err?.message, metadata: err});\n        }        \n    }\n\n    private async next(name: string) {\n        if(!this.isValidProcess())\n            return null;\n            \n        if(this.ctx.wf.activity?.type === \"page-activity\" && !this.ctx.validator.validate(this.ctx))             \n            return null;\n            \n        let newActivity = this.process\n                              .activities\n                              .find(a => a.name === name);                \n                            \n        if(!newActivity)\n            throw new Error(`Activity ${name} not found`);\n\n        this.activity = newActivity;\n\n        \n        return ActivityFactory.create(this.activity, this.ctx)\n                                    .execute();\n    }\n\n    private isValidProcess(): boolean{\n        return typeof this.process !== \"string\" \n            &&  this.process !== undefined \n            && this.process !== null \n            && this.process.activities !== undefined \n            && this.process.activities !== null;\n    }\n}","import { Context } from \"../model/context.model\";\nimport { Control } from \"../model/control.model\";\n\nexport abstract class Validator {\n    constructor(public name: string) { }\n    abstract validate(context: Context, control: Control, config: object): boolean;\n\n    setError(control: Control, error: boolean, message?: string) {\n        control.error = error;\n        control.errorMessage = error ? message : null;\n\n        if(control.el !== null) {\n            control.el.setAttribute(\"error\", control.error === true  ? \"true\" : \"false\");\n            control.el.setAttribute(\"errorMessage\", control.errorMessage);\n        }\n\n        if(control.el.nextSibling[\"attributes\"][\"wf-error\"])\n            control.el.nextSibling.textContent = control.errorMessage;\n    }\n}","import { Context } from '../model/context.model';\nimport { Validator } from './validator';\nimport { Control } from '../model/control.model';\n\nexport interface RequiredValidatorConfig {\n    name: string;\n    message: string;\n}\n\nexport class RequiredValidator extends Validator {\n    validate(context: Context, control: Control, config: RequiredValidatorConfig): boolean {\n        const value = context.model.getValue(control.id);\n        const isEmpty = value === null || value === undefined || value.length === 0;\n        super.setError(control, isEmpty, config.message);\n              \n        return !isEmpty;\n    }\n}","import { Context } from '../model/context.model';\nimport { Validator } from './validator';\nimport { Control } from '../model/control.model';\n\nexport interface RegexValidatorConfig {\n    name: string;\n    message: string;\n    expression: string;\n}\n\nexport class RegexValidator extends Validator {\n    validate(context: Context, control: Control, config: RegexValidatorConfig): boolean {\n        const value = context.model.getValue(control.id);\n        const regex = new RegExp(config.expression, 'g');       \n        const result = regex.exec(value);       \n        const isValid = result != null ? true : false;\n\n        super.setError(control, !isValid, config.message);\n              \n        return isValid;\n    }\n}","import { Context } from '../model/context.model';\nimport { Validator } from './validator';\nimport { Control } from '../model/control.model';\n\nexport interface RangeValidatorConfig {\n    name: string;\n    message: string;\n    min: number;\n    max: number;\n}\n\nexport class RangeValidator extends Validator {\n    validate(context: Context, control: Control, config: RangeValidatorConfig): boolean {\n        const value = +context.model.getValue(control.id);\n        const isValid = value >= config.min && value <= config.max;\n\n        super.setError(control, !isValid, config.message);\n              \n        return isValid;\n    }\n}","import { Control } from './../model/control.model';\nimport { Validator } from \"../validators/validator\";\nimport { RequiredValidator } from \"../validators/required.validator\";\nimport { Context } from \"../model/context.model\";\nimport { RegexValidator } from '../validators/regex.validator';\nimport { RangeValidator } from '../validators/range.validator';\n\nexport class ValidatorService {\n    private validators: Validator[] = [\n        new RequiredValidator(\"required\"),\n        new RegexValidator(\"regex\"),\n        new RangeValidator(\"range\")\n    ];\n    \n    validate(ctx: Context): boolean {                                 \n        if(ctx.page === undefined || ctx.page === null || ctx.page.controls === undefined || ctx.page.controls === null)          \n            return true;\n        \n        let isValid = true;\n\n        for(const ctrl of ctx.page.controls) \n            isValid = this.validateControl(ctx, ctrl) && isValid;\n       \n        return isValid;\n    }  \n\n    addValidator(validator: Validator) {\n        const val = this.validators.find(v => v.name === validator.name);\n\n        if(!val)\n            this.validators.push(validator);\n    }\n    \n    private validateControl(ctx: Context, control: Control): boolean {         \n        if(control === undefined || control === null)\n            return true;\n\n        let isValid = true;\n            \n        for(const index in control.controls)\n            isValid =  this.validateControl(ctx, control.controls[index]) && isValid;\n       \n        if(control.validators !== null && control.validators !== undefined && control.validators.length > 0) {\n            for(const config of control.validators) {                \n                const validator = this.validators.find(v => v.name === config.name);\n\n                if(!validator)\n                    continue;\n                \n                if(!validator.validate(ctx, control, config)) {                \n                    isValid =  false;    \n                    this.sendErrorMsg(ctx, validator, control);                    \n                    break;\n                }\n            }            \n        }\n            \n        return isValid;\n    }\n\n    private sendErrorMsg(ctx: Context, validator: Validator, control: Control) {\n        ctx.page.sendMessage({\n            type: \"VALIDATION_ERROR\",\n            description: control.errorMessage,\n            metadata: {\n                validator: validator.name,\n                control: control.id\n            }\n        });\n    }\n}","import { Context } from \"../model/context.model\";\nimport { Page } from \"../model/page.model\";\nimport { Control } from \"../model/control.model\";\n\nexport class PageBuilder {\n    onInput: (element: HTMLElement & Control) => void;\n    \n    constructor(private ctx: Context & Page){}\n\n    build(parent: HTMLElement, onInput: (element: HTMLElement & Control) => void){\n        this.onInput = onInput;\n\n        this.clearPage(parent);\n        \n        this.ctx.controls.forEach(this.addComponent.bind(this, parent));\n    }\n\n    clearPage(parent: HTMLElement){\n        for(let i = parent.childNodes.length - 1; i >= 0; i--) \n            parent.removeChild(parent.childNodes[i]);    \n    }\n\n    private addComponent(parent: HTMLElement, control: Control) {\n        let newEl: HTMLElement & Control;\n\n        if(control.tag === \"polaris-workflow\") \n            newEl = this.createWorkflowElement(control); \n        else \n            newEl = this.createElement(control); \n        \n        parent.appendChild(newEl);\n        this.addErrorLabel(newEl);\n    }\n\n    private createWorkflowElement(control: Control): HTMLElement & Control{\n        const el = document.createElement(control.tag) as HTMLPolarisWorkflowElement;\n        const newEl = Object.assign(el, control);               \n        newEl.setServices(this.ctx);\n        \n        return newEl;\n    }\n\n    private createElement(control: Control): HTMLElement & Control {        \n        const el = document.createElement(control.tag);\n        const options = {\n            \"wf-Workflow\": \"\",\n            \"ctx\": this.ctx \n        };\n\n        const newEl = Object.assign(el, control, options);\n        control.el = newEl;\n        \n        this.bind(newEl);\n        this.bindCaption(newEl, control);\n        control.controls?.forEach(this.addComponent.bind(this, newEl));\n        \n        return newEl;\n    }\n\n    private bind(newEl: HTMLElement & Control){\n        if(!newEl.id || newEl.value === undefined)\n            return;\n\n        const newValue = this.ctx.model.getValue(newEl.id);\n\n        if(newValue !== undefined)\n            newEl.value = newValue;\n        \n        this.ctx.model.setValue(newEl.id, newEl.value);\n        newEl.oninput = this.onInput.bind(this, newEl);\n    }\n\n    private bindCaption(newEl: HTMLElement, control: Control) {\n        this.interpolate('caption', newEl, control);\n        this.interpolate('textContent', newEl, control);\n        this.interpolate('innerHTML', newEl, control);\n    }\n\n    private interpolate(prop: string, newEl: HTMLElement, control: Control) {\n        if(!newEl[prop])\n            return;\n\n        newEl[prop] = this.ctx.model.getInterpolatedValue(control[prop]||newEl[prop]);\n    }\n\n    private addErrorLabel(newEl: HTMLElement & Control) {\n        if(!newEl.validators)\n            return;\n\n        const errLabel = document.createElement(\"span\");\n        errLabel.setAttribute(\"wf-error\", \"error\");\n\n        newEl.parentNode.appendChild(errLabel);\n    }\n}","import { Process } from \"../model/process.model\";\nimport { HttpService } from \"../services/http.service\";\n\nexport interface WorkflowLoader {\n    load(processName: string): Promise<Process>;\n} \n\nexport class HttpWorkflowLoader implements WorkflowLoader {\n    constructor(private http: HttpService) { }\n    \n    async load(processName: string): Promise<Process> {\n        return this.http.fetch({url: `[WF]/${processName}`, method: 'get'});\n    }\n}","import { Component, Prop, Element, Watch, Method, Event, EventEmitter } from \"@stencil/core\";\n\nimport { Control } from \"../../model/control.model\";\n\nimport { Page } from \"../../model/page.model\";\nimport { Context } from \"../../model/context.model\";\nimport { HttpService } from \"../../services/http.service\";\nimport { ModelService } from \"../../services/model.service\";\nimport { ConfigService } from \"../../services/config.service\";\nimport { WorkflowService } from \"../../services/workflow.service\";\nimport { ValidatorService } from \"../../services/validator.service\";\nimport { Message } from \"../../model/message.model\";\nimport { PageBuilder } from \"../../utilities/page-builder.utility\";\nimport { WorkflowLoader, HttpWorkflowLoader } from \"../../utilities/workflow-loader.utility\";\nimport { Activity } from \"../../activities/activity\";\nimport { ActivityFactory } from \"../../activities/activity-factory\";\nimport { Validator } from \"../../validators/validator\";\nimport { Process } from \"../../model/process.model\";\n\n@Component({\n    tag: \"polaris-workflow\",\n    shadow: false\n  })\n  export class PolarisWorkflow implements Control {    \n    private _components: Control[] = [];\n    private _loader: WorkflowLoader;\n    private _isConnected: boolean;\n    \n    @Prop() parent: Context;\n\n    @Prop() tag: string;\n    @Prop() page: Page = this;\n    @Prop() ctx: Context = this;\n    @Prop() value?: string|object|null|undefined;  \n\n    @Prop() url: string;\n    @Prop() process: string|Process;\n    @Prop() activity: string;\n    @Prop() sessionId: string;\n\n    http: HttpService;\n    config: ConfigService;\n\n    model: ModelService;\n    wf: WorkflowService;\n    validator: ValidatorService;\n    \n    @Element() el: HTMLElement;\n\n    constructor() {\n        console.dir(this);\n        this.http = new HttpService(this.ctx);\n        this.config = new ConfigService();\n\n        this.model = new ModelService(this.ctx.config);\n        this.wf = new WorkflowService(this.ctx);\n        this.validator = new ValidatorService();\n    }\n    \n    @Watch(\"process\")\n    async processChangeHandler() {        \n        await this.load(this.process, this.activity, this.sessionId);\n    }\n\n    @Event()\n    wfMessage: EventEmitter;\n\n    get controls(){return this._components; }\n    set controls(val: Control[]) { \n        this._components = val; \n        this._render(); \n    }\n\n    @Method()\n    async setServices(ctx: Context) {               \n        this.model = ctx.model;\n        this.http = ctx.http;\n        this.config = ctx.config;        \n        this.validator = ctx.validator; \n    }\n    \n    @Method()\n    async load(process: string | Process, next: string = \"start\", sessionId: string = ''): Promise<void> {\n        if(sessionId != null && sessionId.length > 0) {\n            this.ctx.model.sessionId = sessionId;\n            this.ctx.model.load();\n        }\n        \n        await this.wf.setProcess(process, next);       \n    }\n\n    @Method()\n    async addActivity(activity: Activity, replace: boolean = false): Promise<void> {\n        ActivityFactory.add(activity, replace);\n\n        return Promise.resolve();\n    }\n\n    @Method()\n    async addValidator(validator: Validator) {\n        this.validator.addValidator(validator);\n    }\n\n    sendMessage(message: Message): void {\n        const metaData = {\n            process: this.wf.process?.name,\n            activity: this.wf.activity?.name,\n            activityType: this.wf.activity?.type,\n            timestamp: Date.now()\n        };\n\n        if(this._isConnected === true) \n            this.wfMessage.emit({...message, ...metaData});\n    }\n\n    disconnectedCallback() {\n        this._isConnected = false;\n    }\n\n    connectedCallback() {\n        this._isConnected = true;\n    }\n\n    async componentWillLoad() { \n        if(this.url != null) {\n            this.config.addSetting(\"[settingsUrl]\", this.url);\n            const settings = await this.http.fetch({method: \"GET\", url: this.url});\n            Object.keys(settings).forEach(k => this.config.addSetting(k, settings[k]));\n        }\n\n        if(this._loader === null || this._loader === undefined) {\n            this._loader = new HttpWorkflowLoader(this.http);\n            this.wf.loader = this._loader;\n        }\n\n        if(this.parent != null)\n            await this.setServices(this.parent);\n        \n        if(this.process != null)\n            await this.load(this.process, this.activity, this.sessionId);\n    }\n\n    private onInput(newEl: HTMLElement & Control) {\n        this.model.setValue(newEl.id, newEl.value);\n\n        if(newEl.hasAttribute('error'))\n            this.validator.validate(this);\n    }\n\n    private _render() {   \n        const builder = new PageBuilder(this);\n        builder.build(this.el, this.onInput.bind(this));\n    }\n  }"],"mappings":"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"}