import{r as t}from"./p-6c48c477.js";const s=class{constructor(s){t(this,s)}async analyticsHandler(t){const e=s.analyticsService.getPath(t);s.lastPath[0]!==e[0]&&(s.lastPath=e,e.find(t=>void 0!==t["wf-Workflow"])&&(e[0].addEventListener("blur",this.onBlur),s.analyticsService.send("click",e)))}wfMessage(t){s.analyticsService.sendMessage(t)}onBlur(t){s.analyticsService.send("blur",s.lastPath),t.target.removeEventListener("blur",this.onBlur)}};s.lastPath=[null],s.analyticsService=new class{sendMessage(t){this.sendPostMessage(t.detail)}send(t,s){const e=s.find(t=>void 0!==t["wf-Workflow"]);if(!e)return;const r=this.createPayload(t,e,s);r&&this.sendPostMessage({type:r.type,process:r.process,activity:r.activity,control:r.control,valueHash:r.valueHash,path:r.wfPath.map(this.getName)})}getPath(t){return t.composedPath(t)}sendPostMessage(t){const s=Object.assign(Object.assign({},t),{timestamp:Date.now()});console.log("ANALYTICS",s),window.postMessage(s,"*")}getName(t){return t.id?t.id:t.page&&t.page.name?t.page.name:""}createPayload(t,s,e){const r=e.filter(t=>t.nodeName&&-1===t.nodeName.indexOf("document-fragment")),n=r.find(t=>"polaris-workflow"===t.localName);if(!n)return null;const o=n.ctx.wf.activity,a=r.slice(0,r.indexOf(n)+1);return o.name?{type:t,process:n.ctx.wf.process.name,activity:o.name,control:s.id,valueHash:this.getHashCode(s.value),wfPath:a}:null}getHashCode(t){let s,e=0;if(!t||0===t.length)return e;for(let r=0;r<t.length;r++)s=t.charCodeAt(r),e=(e<<5)-e+s,e|=0;return e}};export{s as polaris_analytics};