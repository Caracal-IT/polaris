var __extends=this&&this.__extends||function(){var t=function(e,n){t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n]};return t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();var __awaiter=this&&this.__awaiter||function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(e){o(e)}}function a(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return u([t,e])}}function u(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=s[0]&2?i["return"]:s[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;if(i=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;i=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}if(o[2])n.ops.pop();n.trys.pop();continue}s=e.call(t,n)}catch(a){s=[6,a];i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};System.register(["./p-dc9ef788.system.js"],(function(t){"use strict";var e,n,r;return{setters:[function(t){e=t.r;n=t.c;r=t.g}],execute:function(){var i=function(){function t(){}t.prototype.sendMessage=function(t){this.sendPostMessage(t.detail)};t.prototype.send=function(t,e){var n=e.find((function(t){return t["wf-Workflow"]!==undefined}));if(!n)return;var r=this.createPayload(t,n,e);if(r){this.sendPostMessage({type:r.type,process:r.process,activity:r.activity,control:r.control,valueHash:r.valueHash,path:r.wfPath.map(this.getName)})}};t.prototype.getPath=function(t){return t.composedPath(t)};t.prototype.sendPostMessage=function(t){var e=Object.assign(Object.assign({},t),{timestamp:Date.now()});console.log("ANALYTICS",e);window.postMessage(e,"*")};t.prototype.getName=function(t){if(t.id)return t.id;if(t.page&&t.page.name)return t.page.name;return""};t.prototype.createPayload=function(t,e,n){var r=n.filter((function(t){return t.nodeName&&t.nodeName.indexOf("document-fragment")===-1}));var i=r.find((function(t){return t.localName==="polaris-workflow"}));if(!i)return null;var o=i.ctx.wf.activity;var s=r.slice(0,r.indexOf(i)+1);if(!o.name)return null;var a=i.ctx.wf.process.name;var u=o.name;var c=e.id;var f=this.getHashCode(e.value);return{type:t,process:a,activity:u,control:c,valueHash:f,wfPath:s}};t.prototype.getHashCode=function(t){var e=0;var n;if(!t||t.length===0)return e;for(var r=0;r<t.length;r++){n=t.charCodeAt(r);e=(e<<5)-e+n;e|=0}return e};return t}();var o=t("polaris_analytics",function(){function t(t){e(this,t)}t.prototype.analyticsHandler=function(t){return __awaiter(this,void 0,void 0,(function(){var e,n;return __generator(this,(function(r){e=o.analyticsService.getPath(t);if(o.lastPath[0]===e[0])return[2];o.lastPath=e;n=e.find((function(t){return t["wf-Workflow"]!==undefined}));if(!n)return[2];e[0].addEventListener("blur",this.onBlur);o.analyticsService.send("click",e);return[2]}))}))};t.prototype.wfMessage=function(t){o.analyticsService.sendMessage(t)};t.prototype.onBlur=function(t){o.analyticsService.send("blur",o.lastPath);t.target.removeEventListener("blur",this.onBlur)};return t}());o.lastPath=[null];o.analyticsService=new i;var s=function(){function t(t){this.ctx=t}t.prototype.fetch=function(t){return __awaiter(this,void 0,void 0,(function(){var e,n;var r=this;return __generator(this,(function(i){switch(i.label){case 0:i.trys.push([0,,5,6]);this.ctx.page.sendMessage({type:"START_LOADING"});return[4,fetch(this.resolveSetting(t.url),this.getConfig(t))];case 1:e=i.sent();if(!(e.status>=400))return[3,3];return[4,e.json()];case 2:n=i.sent();if(e.status>=401)this.ctx.page.sendMessage({type:"UN_AUTHORIZED",metadata:{endpoint:t,error:n}});throw{code:e.status,message:e.statusText,error:n};case 3:return[4,e.json()];case 4:return[2,i.sent()];case 5:setTimeout((function(){return r.ctx.page.sendMessage({type:"END_LOADING"})}));return[7];case 6:return[2]}}))}))};t.prototype.getConfig=function(t){return{method:t.method,mode:"cors",headers:Object.apply({"Content-Type":"application/json"},t.headers),redirect:"follow",referrer:"no-referrer",body:t.body?JSON.stringify(t.body):null}};t.prototype.resolveSetting=function(t,e){if(e===void 0){e=0}if(e>2)return t;var n=t.match(/\[[\w|_]+\]/g);if(!n)return t;var r=n.reduce(this.replace.bind(this),t);if(r.indexOf("[")>-1)r=this.resolveSetting(r,e++);return r};t.prototype.replace=function(t,e){var n=this.ctx.config.getSetting(e);if(n&&n.indexOf("[SELF]")>-1)return n.replace("[SELF]",t.replace(e,""));return t.replace(e,n)};return t}();function a(t,e){var n=e[0],r=e[1];var i=new Intl.NumberFormat(n,{style:"currency",currency:r});return i.format(+t)}var u=function(){function t(){this.currencyFormat=a}return t}();var c=function(){function t(t){this.config=t;this.model={};this.sessionId=this.UUID();this.pipes=new u}t.prototype.getValue=function(t,e){if(e===void 0){e=this.model}if(t.indexOf("[")===0||t.indexOf("]")===t.length-1)return this.config.getSetting(t);var n=t.split(".").reduce((function(t,e){return t?t[e]:undefined}),Object.assign({},e));if(!t.match(/([a-z|A-Z]+\.[a-z|A-Z]+)+/g)&&n===undefined)return t;return n};t.prototype.getInterpolatedValue=function(t){var e=this;if(!t)return t;var n=/\{\{\[*(?:(\w|\.|\||-)+)\]*\}\}/g;var r=t.match(n);if(!r||r.length===0)return t;return r.reduce((function(t,n){return e.replaceAll(t,n)}),t)};t.prototype.setValue=function(t,e){if(t.indexOf("[")===0||t.indexOf("]")===t.length-1)this.config.addSetting(t,e);else this.model=this.merge(this.model,t,e)};t.prototype.save=function(){sessionStorage.setItem(this.sessionId,JSON.stringify(this.model))};t.prototype.load=function(){var t=sessionStorage.getItem(this.sessionId);this.clearCache();if(!t)return;this.model=JSON.parse(t)};t.prototype.clearCache=function(){sessionStorage.clear()};t.prototype.merge=function(t,e,n){if(!e)return;var r=Object.assign({},t);e.split(".").reduce((function(t,e,r,i){t[e]=r==i.length-1?n:Object.assign({},t[e]);return t[e]}),r);return r};t.prototype.UUID=function(){return"xxxxxxxxRxxxxR4xxxRyxxxRxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=Math.random()*16|0,n=t=="x"?e:e&3|8;return n.toString(16)}))};t.prototype.replaceAll=function(t,e){var n=e.substring(2,e.length-2);var r=n.split("|");var i=r.slice(2);var o=this.getValue(r[0]);if(r&&r.length>1&&this.pipes[r[1]])o=this.pipes[r[1]](o,i);return t.replace(e,o)};return t}();var f=function(){function t(){this.settings={}}t.prototype.getSetting=function(t){return this.settings[t]};t.prototype.addSetting=function(t,e){if(t.indexOf("[")===-1)t="["+t+"]";this.settings[t]=e};return t}();var h=function(){function t(){this.name="redirect";this.type="redirect-activity"}t.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(n){this.ctx.model.save();e=((t=this.ctx.wf.process)===null||t===void 0?void 0:t.name)+"-"+this.next+"-"+this.ctx.model.sessionId;window.location.href=this.location+"?returnUrl="+e;return[2,true]}))}))};return t}();var l=function(){function t(){this.name="finish";this.type="finish-activity"}t.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){if(this.ctx.wf.stack.length===0){if(this.next)this.ctx.wf.goto(this.next);return[2,true]}t=this.ctx.wf.stack.pop();this.ctx.wf.setProcess(t.process,t.activity);return[2,true]}))}))};return t}();var p=function(){function t(){this.name="ipc";this.type="ipc-activity"}t.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){if(this.process&&this.process.length>0){this.ctx.wf.stack.push({process:this.ctx.wf.process.name,activity:this.next});this.ctx.wf.setProcess(this.process,"start",this.next?false:true)}return[2,true]}))}))};return t}();var d=function(){function t(){this.name="code";this.type="code-activity"}t.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.eval(this.expression,this.ctx);if(this.next&&this.next.length>0)this.ctx.wf.goto(this.next);return[2,true]}))}))};t.prototype.eval=function(t,e){var n=new Function("ctx",t);return n(e)};return t}();var v=function(){function t(){this.name="start";this.type="page-activity"}t.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){if(this.ctx.page.controls)this.ctx.page.controls=this.controls||[];return[2,true]}))}))};return t}();var g=function(){function t(){this.name="undefined";this.type="null-activity"}t.prototype.execute=function(){return new Promise((function(t,e){return e("NULL Activity")}))};return t}();var y=function(){function t(){this.name="start";this.type="api-activity"}t.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.callEndpoints()];case 1:t.sent();this.gotoNext();return[2,true]}}))}))};t.prototype.callEndpoints=function(){return __awaiter(this,void 0,void 0,(function(){var t,e,n;return __generator(this,(function(r){switch(r.label){case 0:t=0,e=this.endpoints;r.label=1;case 1:if(!(t<e.length))return[3,4];n=e[t];n.body=this.getBody(n);return[4,this.callEndpoint(this.ctx.http,n)];case 2:r.sent();r.label=3;case 3:t++;return[3,1];case 4:return[2,true]}}))}))};t.prototype.callEndpoint=function(t,e){return __awaiter(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(r){return[2,t.fetch(e).then((function(t){return n.setModel(e,t)}))]}))}))};t.prototype.gotoNext=function(){if(this.next&&this.ctx)this.ctx.wf.goto(this.next)};t.prototype.getBody=function(t){if(!this.ctx||!this.ctx.model||t.method.toUpperCase()==="GET"||t.method.toUpperCase()==="DELETE")return null;var e=this.ctx.model;var n=t.mappings;var r={};n.filter((function(t){return t.direction==="out"||t.direction==="inout"})).forEach((function(t){var n;return Object.assign(r,(n={},n[t.remote]=e.getValue(t.client),n))}));return r};t.prototype.setModel=function(t,e){if(!this.ctx||!this.ctx.model)return;var n=this.ctx.model;var r=t.mappings;if(!r||r.length===0)return Object.keys(e).forEach((function(t){return n.setValue(t,e[t])}));r.filter((function(t){return t.direction==="in"||t.direction==="inout"})).forEach((function(t){return n.setValue(t.client,n.getValue(t.remote,e))}))};return t}();var x=function(){function t(){this.name="assign";this.type="assign-activity"}t.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){t=this.ctx.model.getInterpolatedValue(this.value);this.ctx.model.setValue(this.key,t);this.ctx.wf.goto(this.next);return[2,true]}))}))};return t}();var w=function(t){__extends(e,t);function e(){var e=t.apply(this,arguments)||this;e.name="decision";e.type="decision-activity";return e}e.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){t="return "+this.ctx.model.getInterpolatedValue(this.expression)+";";if(this.eval(t,this.ctx))this.ctx.wf.goto(this.trueAction);else this.ctx.wf.goto(this.falseAction);return[2,true]}))}))};return e}(d);var _=function(t){__extends(e,t);function e(){var e=t.apply(this,arguments)||this;e.name="switch";e.type="switch-activity";return e}e.prototype.execute=function(){return __awaiter(this,void 0,void 0,(function(){var t,e,n,r;return __generator(this,(function(i){for(t=0,e=this.rules||[];t<e.length;t++){n=e[t];r="return "+this.ctx.model.getInterpolatedValue(n.expression)+";";if(this.eval(r,this.ctx)){this.ctx.wf.goto(n.next);return[2,true]}}throw new Error("No valid rule in "+this.name+" found !!")}))}))};return e}(d);var m=function(){function t(){}t.create=function(e,n){if(!e||!e.type)return new g;var r=t.activities.find((function(t){return t.type===e.type}));if(!r)return new g;return Object.assign(r,e,{ctx:n})};t.add=function(e){var n=t.activities.find((function(t){return t.type===e.type}));if(!n)t.activities.push(e)};return t}();m.activities=[new g,new v,new y,new x,new d,new w,new p,new l,new h,new _];var b=function(){function t(t){this.ctx=t;this.stack=[]}t.prototype.setProcess=function(t,e,n){if(e===void 0){e="start"}if(n===void 0){n=true}return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(i){switch(i.label){case 0:i.trys.push([0,3,,4]);if(n)this.stack=[];if(!(typeof t==="string"&&this.loader))return[3,2];return[4,this.loader.load(t)];case 1:t=i.sent();i.label=2;case 2:this.process=t;this.activity=null;this.goto(e);this.ctx.page.sendMessage({type:"PROCESS_CHANGED",metadata:{stack:this.stack}});return[3,4];case 3:r=i.sent();if(r){console.error(r);this.ctx.page.sendMessage({type:"ERROR",description:r.message,metadata:r})}return[3,4];case 4:return[2]}}))}))};t.prototype.goto=function(t){setTimeout(this.tryNext.bind(this,t))};t.prototype.tryNext=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);this.ctx.page.sendMessage({type:"WORKFLOW_CHANGING"});return[4,this.next(t)];case 1:n.sent();this.ctx.page.sendMessage({type:"WORKFLOW_CHANGED"});return[3,3];case 2:e=n.sent();this.ctx.page.sendMessage({type:"ERROR",description:e===null||e===void 0?void 0:e.message,metadata:e});return[3,3];case 3:return[2]}}))}))};t.prototype.next=function(t){return __awaiter(this,void 0,void 0,(function(){var e,n;return __generator(this,(function(r){switch(r.label){case 0:if(!this.process||!this.process.activities)return[2,null];if(((e=this.ctx.wf.activity)===null||e===void 0?void 0:e.type)==="page-activity"&&!this.ctx.validator.validate(this.ctx))return[2,null];n=this.process.activities.find((function(e){return e.name==t}));if(!n)throw new Error("Activity "+t+" not found");this.activity=n;return[4,m.create(this.activity,this.ctx).execute()];case 1:return[2,r.sent()]}}))}))};return t}();var E=function(){function t(t){this.name=t}t.prototype.setError=function(t,e,n){t.error=e;t.errorMessage=e?n:null;if(t.el){t.el.setAttribute("error",t.error?"true":"false");t.el.setAttribute("errorMessage",t.errorMessage)}if(t.el.nextSibling["attributes"]["wf-error"])t.el.nextSibling.textContent=t.errorMessage};return t}();var O=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.validate=function(e,n,r){var i=e.model.getValue(n.id);var o=i===null||i===undefined||i.length===0;t.prototype.setError.call(this,n,o,r.message);return!o};return e}(E);var S=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.validate=function(e,n,r){var i=e.model.getValue(n.id);var o=new RegExp(r.expression,"g");var s=o.exec(i);var a=s?true:false;t.prototype.setError.call(this,n,!a,r.message);return a};return e}(E);var M=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.validate=function(e,n,r){var i=+e.model.getValue(n.id);var o=i>=r.min&&i<=r.max;t.prototype.setError.call(this,n,!o,r.message);return o};return e}(E);var C=function(){function t(){this.validators=[new O("required"),new S("regex"),new M("range")]}t.prototype.validate=function(t){if(!t.page||!t.page.controls)return true;var e=true;for(var n=0,r=t.page.controls;n<r.length;n++){var i=r[n];e=this.validateControl(t,i)&&e}return e};t.prototype.addValidator=function(t){var e=this.validators.find((function(e){return e.name===t.name}));if(!e)this.validators.push(t)};t.prototype.validateControl=function(t,e){if(!e)return true;var n=true;for(var r in e.controls)n=this.validateControl(t,e.controls[r])&&n;if(e.validators&&e.validators.length>0){var i=function(r){var i=o.validators.find((function(t){return t.name===r.name}));if(!i)return"continue";if(!i.validate(t,e,r)){n=false;o.sendErrorMsg(t,i,e);return"break"}};var o=this;for(var s=0,a=e.validators;s<a.length;s++){var u=a[s];var c=i(u);if(c==="break")break}}return n};t.prototype.sendErrorMsg=function(t,e,n){t.page.sendMessage({type:"VALIDATION_ERROR",description:n.errorMessage,metadata:{validator:e.name,control:n.id}})};return t}();var I=function(){function t(t){this.ctx=t}t.prototype.build=function(t,e){this.onInput=e;this.clearPage(t);this.ctx.controls.forEach(this.addComponent.bind(this,t))};t.prototype.clearPage=function(t){for(var e=t.childNodes.length-1;e>=0;e--)t.removeChild(t.childNodes[e])};t.prototype.addComponent=function(t,e){var n;if(e.tag==="polaris-workflow")n=this.createWorkflowElement(e);else n=this.createElement(e);t.appendChild(n);this.addErrorLabel(n)};t.prototype.createWorkflowElement=function(t){var e=document.createElement(t.tag);var n=Object.assign(e,t);n.setServices(this.ctx);return n};t.prototype.createElement=function(t){var e;var n=document.createElement(t.tag);var r={"wf-Workflow":"",ctx:this.ctx};var i=Object.assign(n,t,r);t.el=i;this.bind(i);this.bindCaption(i,t);(e=t.controls)===null||e===void 0?void 0:e.forEach(this.addComponent.bind(this,i));return i};t.prototype.bind=function(t){if(!t.id||t.value===undefined)return;var e=this.ctx.model.getValue(t.id);if(e!==undefined)t.value=e;this.ctx.model.setValue(t.id,t.value);t.oninput=this.onInput.bind(this,t)};t.prototype.bindCaption=function(t,e){this.interpolate("caption",t,e);this.interpolate("textContent",t,e);this.interpolate("innerHTML",t,e)};t.prototype.interpolate=function(t,e,n){if(!e[t])return;e[t]=this.ctx.model.getInterpolatedValue(n[t]||e[t])};t.prototype.addErrorLabel=function(t){if(!t.validators)return;var e=document.createElement("span");e.setAttribute("wf-error","error");t.parentNode.appendChild(e)};return t}();var N=function(){function t(t){this.http=t}t.prototype.load=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.http.fetch({url:"[WF]/"+t,method:"get"})];case 1:return[2,e.sent()]}}))}))};return t}();var P=t("polaris_workflow",function(){function t(t){e(this,t);this.page=this;this._components=[];this.ctx=this;this.http=new s(this.ctx);this.config=new f;this.model=new c(this.ctx.config);this.wf=new b(this.ctx);this.validator=new C;this.wfMessage=n(this,"wfMessage",7)}t.prototype.processChangeHandler=function(){this.load(this.process,this.activity,this.sessionId)};Object.defineProperty(t.prototype,"controls",{get:function(){return this._components},set:function(t){this._components=t;this._render()},enumerable:true,configurable:true});t.prototype.setServices=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.model=t.model;this.http=t.http;this.config=t.config;this.validator=t.validator;return[2]}))}))};t.prototype.load=function(t,e,n){if(e===void 0){e="start"}if(n===void 0){n=""}return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:if(n&&n.length>0){this.ctx.model.sessionId=n;this.ctx.model.load()}return[4,this.wf.setProcess(t,e)];case 1:r.sent();return[2]}}))}))};t.prototype.addActivity=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){m.add(t);return[2]}))}))};t.prototype.addValidator=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.validator.addValidator(t);return[2]}))}))};t.prototype.sendMessage=function(t){var e,n,r;var i={process:(e=this.wf.process)===null||e===void 0?void 0:e.name,activity:(n=this.wf.activity)===null||n===void 0?void 0:n.name,activityType:(r=this.wf.activity)===null||r===void 0?void 0:r.type,timestamp:Date.now()};this.wfMessage.emit(Object.assign(Object.assign({},t),i))};t.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,(function(){var t;var e=this;return __generator(this,(function(n){switch(n.label){case 0:if(!this.url)return[3,2];this.config.addSetting("[settingsUrl]",this.url);return[4,this.http.fetch({method:"GET",url:this.url})];case 1:t=n.sent();Object.keys(t).forEach((function(n){return e.config.addSetting(n,t[n])}));n.label=2;case 2:if(!this._loader){this._loader=new N(this.http);this.wf.loader=this._loader}if(this.parent)this.setServices(this.parent);if(this.process)this.load(this.process,this.activity,this.sessionId);return[2]}}))}))};t.prototype.onInput=function(t){this.model.setValue(t.id,t.value);if(t.hasAttribute("error"))this.validator.validate(this)};t.prototype._render=function(){var t=new I(this);t.build(this.el,this.onInput.bind(this))};Object.defineProperty(t.prototype,"el",{get:function(){return r(this)},enumerable:true,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{process:["processChangeHandler"]}},enumerable:true,configurable:true});return t}())}}}));